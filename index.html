
<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Générateur d’image lenticulaire</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      font-size: 18px;
      margin: 0;
      padding: 20px;
      background: #f4f4f4;
    }

    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-end;
      flex-wrap: wrap;
    }

    header h1 {
      margin: 0;
    }

    header .author {
      font-weight: bold;
      margin-top: 8px;
    }

    .project {
      margin-top: 10px;
      margin-bottom: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-width: 500px;
      margin-bottom: 20px;
    }

    label {
      font-weight: bold;
    }

    input, select, button {
      padding: 8px;
      font-size: 18px;
      width: 100%;
      box-sizing: border-box;
    }

    button {
      background-color: #007BFF;
      color: white;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    canvas {
      display: block;
      margin-top: 30px;
      background: white;
      border: 1px solid #333;
      max-width: 100%;
      height: auto;
    }
  </style>
</head>
<body>

  <header>
    <h1>Générateur d’image lenticulaire</h1>
    <div class="author">Auteur : René Hippert</div>
  </header>
  <div class="project"><strong>Projet :</strong> Autoportrait (parcours en Y)</div>

  <div class="form-group">
    <label for="image1">Image 1 :</label>
    <input type="file" id="image1" accept=".png,.jpg,.jpeg,.gif,.bmp,.webp">

    <label for="image2">Image 2 :</label>
    <input type="file" id="image2" accept=".png,.jpg,.jpeg,.gif,.bmp,.webp">

    <label for="format">Format :</label>
    <select id="format">
      <option value="A4" selected>A4 (210x297 mm)</option>
      <option value="A3">A3 (297x420 mm)</option>
      <option value="A5">A5 (148x210 mm)</option>
      <option value="Custom">Libre</option>
    </select>

    <label for="orientation">Orientation :</label>
    <select id="orientation">
      <option value="portrait" selected>Portrait</option>
      <option value="landscape">Paysage</option>
    </select>

    <label for="manualWidth">Largeur (mm) :</label>
    <input type="number" id="manualWidth" value="210">

    <label for="manualHeight">Hauteur (mm) :</label>
    <input type="number" id="manualHeight" value="297">

    <label for="unit">Unités :</label>
    <select id="unit">
      <option value="mm" selected>Millimètres</option>
      <option value="px">Pixels</option>
    </select>

    <label for="lines">Nombre de bandes :</label>
    <input type="number" id="lines" value="20" min="2" max="200">

    <label for="exportFormat">Format d’export :</label>
    <select id="exportFormat">
      <option value="png" selected>PNG</option>
      <option value="jpeg">JPEG</option>
      <option value="webp">WebP</option>
    </select>

    <button onclick="download()">Télécharger l’image</button>
  </div>

  <canvas id="result" width="800" height="600"></canvas>

  <script>
    let img1 = null, img2 = null;

    function convertToPx(value, unit) {
      return unit === "mm" ? value * 3.7795275591 : value;
    }

    function loadImage(file, callback) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          callback(img);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }

    function draw() {
      if (img1 && img2) generate();
    }

    function generate() {
      const format = document.getElementById("format").value;
      const orientation = document.getElementById("orientation").value;
      const unit = document.getElementById("unit").value;
      const lines = parseInt(document.getElementById("lines").value);

      let widthMM = 210, heightMM = 297;

      if (format === "A3") { widthMM = 297; heightMM = 420; }
      else if (format === "A5") { widthMM = 148; heightMM = 210; }
      else if (format === "Custom") {
        widthMM = parseFloat(document.getElementById("manualWidth").value);
        heightMM = parseFloat(document.getElementById("manualHeight").value);
      }

      if (orientation === "landscape") {
        [widthMM, heightMM] = [heightMM, widthMM];
      }

      const canvas = document.getElementById("result");
      const ctx = canvas.getContext("2d");

      const width = Math.floor(convertToPx(widthMM, unit));
      const height = Math.floor(convertToPx(heightMM, unit));
      canvas.width = width;
      canvas.height = height;

      const bandWidth = width / lines;
      for (let i = 0; i < lines; i++) {
        const src = i % 2 === 0 ? img1 : img2;
        ctx.drawImage(
          src,
          (i * src.width) / lines, 0, src.width / lines, src.height,
          i * bandWidth, 0, bandWidth, height
        );
      }
    }

    function download() {
      const canvas = document.getElementById("result");
      const format = document.getElementById("exportFormat").value;
      const link = document.createElement("a");
      link.download = "image_lenticulaire." + format;
      link.href = canvas.toDataURL("image/" + format);
      link.click();
    }

    document.getElementById("image1").addEventListener("change", function(e) {
      loadImage(e.target.files[0], function(img) {
        img1 = img;
        draw();
      });
    });

    document.getElementById("image2").addEventListener("change", function(e) {
      loadImage(e.target.files[0], function(img) {
        img2 = img;
        draw();
      });
    });

    const autoFields = ["format", "orientation", "unit", "lines", "manualWidth", "manualHeight"];
    autoFields.forEach(id => {
      document.getElementById(id).addEventListener("change", () => {
        setTimeout(generate, 100);
      });
    });
  </script>
</body>
</html>
